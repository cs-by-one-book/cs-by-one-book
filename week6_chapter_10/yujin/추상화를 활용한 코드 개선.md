# 추상화를 활용한 코드 개선

동물 추측 게임은 다시 시작 할 때마다 고양이와 개밖에 모르는 상태에서 시작한다.

마지막 게임 상태를 저장하여 계속 게임을 진행하면 더 좋을 것이다.

이런 기능은 자바스크립트보다 C 프로그램에서 작성하기 더 쉽다.

![image-20211223175928084](https://raw.githubusercontent.com/yujin-kim-92/typora-image/main/img/image-20211223175928084.png)

운영체제는 파일과 장치에 대해 똑같은 인터페이스를 제공한다.

>  인터페이스 : 서로 다른 두 시스템을 연결해주는 것

자바스크립트로 작성한 코드는 브라우저를 거쳐 입력받을 수 있지만, C언어로 작성한 코드는 운영체제에서 직접 입력을 받을 수 있다.

# 런타임 라이브러리와 표준 입출력

![image-20211223184506526](https://raw.githubusercontent.com/yujin-kim-92/typora-image/main/img/image-20211223184506526.png)

C 언어 실행 과정

*  전처리기 : # 구문(ex #include<stdio.h>) 처리
*  컴파일러 : 고수준 언어 ->  저수준 언어
*  어셈블러 : 저수준 언어 -> 기계어
*  링커 : 여러개의 오브젝트 파일(.obj)을 하나로 합치거나 라이브러리를 합침

>  런타임 라이브러리 : 프로그램을 실행하는 동안 프로그래밍 언어로 기능을 추가하기 위해 컴파일러가 사용하는 특별한 라이브러리 (입출력, 메모리 관리, 산술 함수에 대한 기능이 포함)

런타임 라이브러리는 추가로 터미널 창치 드라이버와 연관된 파일을 하나는 입력을 위해, 다른 하나는 출력을 위해서 연다.

stdio 라이브러리는 시스템 파일 디스크립터를 파일 포인터와 연관시킨다.

>  파일 디스크립터(File Descriptor) : 리눅스 혹은 유닉스 계열의 시스템에서 프로세스(process)가 파일(file)을 다룰 때 사용하는 개념으로, 프로세스에서 특정 파일에 접근할 때 사용하는 추상적인 값이다. **파일 디스크럽터는 일반적으로 0이 아닌 정수값을 갖는다.** 

>  파일 포인터 : 하드디스크에서 메모리로 읽어들일 화일의 `위치 주소` 및 `버퍼링`에 대한 추상화된 정보를 가지고 있는 포인터를 말함, 버퍼링이나 파일 관리에 필요한 데이터 구조

stdio가 제공하는 파일 포인터

*  stdin : 표준 입력
*  stdout : 표준 출력
*  stderr : 표준 오류 출력 

![image-20211223190128033](https://raw.githubusercontent.com/yujin-kim-92/typora-image/main/img/image-20211223190128033.png)

stderr, stdout 같은 대상으로 데이터를 보내지만 stdout만 버퍼를 사용한다.

stderr 발명 계기

사진 조판 장치에서 사진 대신 오류 메세지가 찍힌 페이지를 얻는 경우가 있다.

이런 경우 오류 메세지를 사진 조판장치로 보내지 않고 터미널로 보내기 위해서 stderr이 만들어 졌다.

# 버퍼 오버플로

초기의 stdio에서는 stdin에서 사용자가 새줄 문자를 입력할 때까지 받은 입력을 사용자가 제공한 버퍼로 전송하는 `gets` 라는 함수가 있었다.

 `gets` 는 입력이 버퍼 끝을 벗어나지 않는지 검사하지 않기 때문에 문제가 있다.

![image-20211223192925676](https://raw.githubusercontent.com/yujin-kim-92/typora-image/main/img/image-20211223192925676.png)![image-20211223192933088](https://raw.githubusercontent.com/yujin-kim-92/typora-image/main/img/image-20211223192933088.png)

만약 입력 버퍼 다음에 미사일 발사 버퍼가 있고 yyy를 입력하여 미사일 발사 버퍼에 y라는 입력을 넣어 나쁜일이 발생 할 수도 있다.

발견된 보안 문제의 대부분은 이와 같은 오버플로 버그로 인한 문제다.

향후 stdio에는 버퍼 경계를 검사하는 `fgets`하는 함수를 추가하여 수정됐다.