## 락

코드에서 중요한 부분을 상호 배제 메커니즘을 통해 원자적으로 처리하게 해야 한다.

어드바이저리 락(advisory lock)을 만들어서 달성한다.

![image-20220106195810708](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20220106195810708.png)

![image-20220106195822198](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20220106195822198.png)

은행 사이의 통신이 느리다면?

### 트랜잭션과 작업 크기

다음 연산 수행 이전에 이전 연산이 성공했는지 알아야 하기 때문에 양방향 통신이어야 한다.

성능 향상 -> 트랜잭션

![image-20220106195830721](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20220106195830721.png)

여러 연산을 한 트랜잭션에 넣는 것

각 연산을 원자적으로 수행하는 대신 한꺼번에 묶어서 처리한다.

락 걸리는 시간을 최소화. 락이 걸린 작업의 크기 최소화

전체 은행이 아니라 대상 계좌만 잠그기 



## 락 대기

락을 기다리는 동안 유용한 작업을 수행해야 한다.

**스핀**: 락을 얻을 때까지 반복 시도

락 관리쪽에 락 요청을 등록하고 요청이 받아들여질 때 통지 받기.



**이더넷**

락을 사용하지는 않지만 여러 장치가 접근 시도해서 충돌 시 기다린 다음 재시도 한다.



**블로킹**: 시스템이 락을 할당할 수 있을 때까지 락 요청 프로그램을 일시중단(suspend)

**논블로킹**: 프로그램이 계록 실행되고 나중에 락 얻었는지 여부를 통지받음.